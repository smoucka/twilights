<!DOCTYPE html>
<html>
	<head>
		<title>3T</title>
		<style>
		</style>
	</head>
	<body>
		<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
		<script type="text/javascript">
			
			var margin = {top:50, right:50, bottom:50, left:150},
				width = 500 - margin.left - margin.right,
				height = 700 - margin.top - margin.bottom;
			
			var xScale = d3.scale.linear()
				.domain([0,1440])
				.range([0,width]);

			var yScale = d3.scale.linear()
				.domain([0,365])
				.rangeRound([0,height]);

			var a_color = "#0B3442",
				n_color = "#026789",
				c_color = "#63B4CF",
				s_color = "#FAFCB3";

			var svg = d3.select("body").append("svg")
				.attr("width", width)
				.attr("height", height);

			function convert_time(in_time) {
				var minutes = parseInt(in_time.substring(0,2)) * 60 + parseInt(in_time.substring(2,4))
				return minutes
			}
			
			d3.csv("parsed_data/miami_times.csv", function(d, i) {
					return {
						day: i,
						a_beg: convert_time(d.astro_beg),
						n_beg: convert_time(d.naut_beg),
						c_beg: convert_time(d.civ_beg),
						s_beg: convert_time(d.rise),
						s_end: convert_time(d.set),
						c_end: convert_time(d.civ_end),
						n_end: convert_time(d.naut_end),
						a_end: convert_time(d.astro_end)
					};
				}, function(error, rows) {
					draw(error, rows);
				}
			);
			
			function draw(error, rows) {

				g = svg.selectAll("rect")
					.data(rows)
					.enter();

				g.append("rect")
					.attr("width", xScale(1440))
					.attr("height", yScale(1))
					.attr("transform", function(d) {
						return "translate(0, " + yScale(d.day) + ")"
					})
					.style("fill", a_color);

				g.append("rect")
					.attr("width", function(d) {
						return xScale(d.n_end)-xScale(d.n_beg)
					})
					.attr("height", yScale(1))
					.attr("transform", function(d) {
						return "translate(" + xScale(d.n_beg) + ", " + yScale(d.day) + ")"
					})
					.style("fill", n_color);

				g.append("rect")
					.attr("width", function(d) {
						return xScale(d.c_end)-xScale(d.c_beg)
					})
					.attr("height", yScale(1))
					.attr("transform", function(d) {
						return "translate(" + xScale(d.c_beg) + ", " + yScale(d.day) + ")"
					})
					.style("fill", c_color);

				g.append("rect")
					.attr("width", function(d) {
						return xScale(d.s_end)-xScale(d.s_beg)
					})
					.attr("height", yScale(1))
					.attr("transform", function(d) {
						return "translate(" + xScale(d.s_beg) + ", " + yScale(d.day) + ")"
					})
					.style("fill", s_color);
			}
			
		</script>
	</body>
</html>